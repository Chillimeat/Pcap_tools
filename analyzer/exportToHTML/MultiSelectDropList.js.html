<html>
<head>
<title>MultiSelectDropList.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(0,0,0); }
.s1 { color: rgb(0,0,128); font-weight: bold; }
.s2 { color: rgb(128,128,128); font-style: italic; }
.s3 { color: rgb(0,128,0); font-weight: bold; }
.s4 { color: rgb(0,0,255); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
MultiSelectDropList.js</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">(</span><span class="s1">function </span><span class="s0">($){ 
    
   $.fn.extend({ 
        MSDL: </span><span class="s1">function </span><span class="s0">(options){</span><span class="s2">/*MultiSelectDropList*/</span><span class="s0"> 
         </span><span class="s2">//各种属性参数</span><span class="s0"> 
          
         </span><span class="s1">var </span><span class="s0">defaults = { 
            width: </span><span class="s3">'150'</span><span class="s0">,</span><span class="s2">//下拉列表宽 </span><span class="s0"> 
            maxheight: </span><span class="s3">'180'</span><span class="s0">,</span><span class="s2">//下拉列表最大高度</span><span class="s0"> 
            data: [</span><span class="s3">'item1'</span><span class="s0">,</span><span class="s3">'item2'</span><span class="s0">,</span><span class="s3">'item3'</span><span class="s0">,</span><span class="s3">'item4'</span><span class="s0">,</span><span class="s3">'item5'</span><span class="s0">,</span><span class="s3">'item6'</span><span class="s0">],</span><span class="s2">//下拉列表中的数据  </span><span class="s0"> 
            selectallTxt: </span><span class="s3">'All'</span><span class="s0">,</span><span class="s2">//全选文本</span><span class="s0"> 
            selectokTxt: </span><span class="s3">'ok'</span><span class="s0">,</span><span class="s2">//确认文本</span><span class="s0"> 
         }; 
         </span><span class="s1">var </span><span class="s0">options = $.extend(defaults, options); 
          
         </span><span class="s1">return this</span><span class="s0">.each(</span><span class="s1">function </span><span class="s0">(){ 
          
         </span><span class="s2">//插件实现代码</span><span class="s0"> 
            </span><span class="s2">//创建 input输入框</span><span class="s0"> 
            </span><span class="s2">//readonly:锁住键盘，不能向文本框输入内容  </span><span class="s0"> 
            </span><span class="s1">var </span><span class="s0">$ipt = $(</span><span class="s3">'&lt;input type=&quot;text&quot; readonly value=&quot;&quot; class=&quot;select_rel&quot; /&gt;'</span><span class="s0">); 
            $ipt.width(options.width - </span><span class="s4">8</span><span class="s0">);</span><span class="s2">//设定文本框宽度</span><span class="s0"> 
             
            </span><span class="s1">var </span><span class="s0">$this = $(</span><span class="s1">this</span><span class="s0">); 
            $this.width(options.width); 
            $ipt.appendTo($this); 
             
            </span><span class="s2">//创建 下拉选项 </span><span class="s0"> 
             
            </span><span class="s2">//1.下拉选项包裹</span><span class="s0"> 
            </span><span class="s1">var </span><span class="s0">$container = $(</span><span class="s3">'&lt;div class=&quot;container&quot;&gt;&lt;/div&gt;'</span><span class="s0">); 
         
             
            </span><span class="s2">//2.创建 全选和确认按钮  top层 </span><span class="s0"> 
            </span><span class="s1">var </span><span class="s0">$top = $(</span><span class="s3">'&lt;div class=&quot;top&quot;&gt;&lt;/div&gt;'</span><span class="s0">);</span><span class="s2">//外层div包裹</span><span class="s0"> 
            </span><span class="s1">var </span><span class="s0">$all = $(</span><span class="s3">'&lt;input type=&quot;checkbox&quot; class=&quot;select_all&quot;/&gt;&lt;label&gt;'</span><span class="s0">+options.selectallTxt+</span><span class="s3">'&lt;/label&gt;'</span><span class="s0">);</span><span class="s2">//全选</span><span class="s0"> 
            </span><span class="s1">var </span><span class="s0">$btn = $(</span><span class="s3">'&lt;button class=&quot;ok&quot;&gt;'</span><span class="s0">+options.selectokTxt+</span><span class="s3">'&lt;/button&gt;'</span><span class="s0">); 
            $all.appendTo($top); 
            $btn.appendTo($top); 
             
            </span><span class="s2">//3.下拉中的内容 content层</span><span class="s0"> 
            </span><span class="s1">var </span><span class="s0">$content = $(</span><span class="s3">'&lt;div class=&quot;content&quot;&gt;&lt;/div&gt;'</span><span class="s0">);</span><span class="s2">//外层div包裹</span><span class="s0"> 
            </span><span class="s1">var </span><span class="s0">count = options.data.length; 
            </span><span class="s1">var </span><span class="s0">h = ( (count * </span><span class="s4">22</span><span class="s0">) &gt; parseInt(options.maxheight) ) ? options.maxheight : </span><span class="s3">&quot;'&quot; </span><span class="s0">+ count * </span><span class="s4">22 </span><span class="s0">+ </span><span class="s3">&quot;'&quot;</span><span class="s0">; 
            $content.height(h); 
            </span><span class="s1">for</span><span class="s0">(</span><span class="s1">var </span><span class="s0">i = count-</span><span class="s4">1</span><span class="s0">; i &gt;= </span><span class="s4">0</span><span class="s0">; i--){ 
               
               </span><span class="s1">var </span><span class="s0">$list = $(</span><span class="s3">'&lt;div&gt;&lt;input type=&quot;checkbox&quot; value='</span><span class="s0">+options.data[i]+</span><span class="s3">' /&gt;&lt;label&gt;'</span><span class="s0">+options.data[i]+</span><span class="s3">'&lt;/label&gt;&lt;br&gt;&lt;/div&gt;'</span><span class="s0">); 
               $list.appendTo($content); 
            } 
            
            </span><span class="s2">//4把top层和content层加到$container下</span><span class="s0"> 
            $top.appendTo($container); 
            $content.appendTo($container);   
 
            </span><span class="s2">//把$container加到$(this)下</span><span class="s0"> 
            $container.appendTo($this);  
 
             
            </span><span class="s2">//js Effect</span><span class="s0"> 
            </span><span class="s1">var </span><span class="s0">$dropList = $content.children().children(</span><span class="s3">'input'</span><span class="s0">); 
             
            $all.change(</span><span class="s1">function </span><span class="s0">(){</span><span class="s2">//点击all</span><span class="s0"> 
                 
                  </span><span class="s1">var </span><span class="s0">opt_arr = []; 
                  $dropList.each(</span><span class="s1">function </span><span class="s0">(){ 
                      </span><span class="s1">if</span><span class="s0">($all.is(</span><span class="s3">':checked'</span><span class="s0">)){ 
                          $(</span><span class="s1">this</span><span class="s0">)[</span><span class="s4">0</span><span class="s0">].checked = </span><span class="s3">'checked'</span><span class="s0">; 
                          opt_arr.push($(</span><span class="s1">this</span><span class="s0">).val()); 
                      }</span><span class="s1">else</span><span class="s0">{ 
                          $(</span><span class="s1">this</span><span class="s0">)[</span><span class="s4">0</span><span class="s0">].checked = </span><span class="s3">''</span><span class="s0">; 
                          opt_arr=[]; 
                      } 
                  });  
                   
                  $ipt.val(opt_arr.join(</span><span class="s3">';'</span><span class="s0">));     
            }); 
             
            $container.addClass(</span><span class="s3">'hidden'</span><span class="s0">);</span><span class="s2">//开始隐藏</span><span class="s0"> 
             
            $ipt.focus(</span><span class="s1">function </span><span class="s0">(){</span><span class="s2">//文本框处于编辑</span><span class="s0"> 
                $container.removeClass(</span><span class="s3">'hidden'</span><span class="s0">); 
                $this.addClass(</span><span class="s3">'multi_select_focus'</span><span class="s0">); 
            }); 
             
            $btn.click(</span><span class="s1">function </span><span class="s0">(){</span><span class="s2">//点击 ok按钮 </span><span class="s0"> 
                $container.addClass(</span><span class="s3">'hidden'</span><span class="s0">); 
                $this.removeClass(</span><span class="s3">'multi_select_focus'</span><span class="s0">); 
            }); 
             
             
            $dropList.change(</span><span class="s1">function </span><span class="s0">(){</span><span class="s2">//勾选选项</span><span class="s0"> 
                 </span><span class="s1">var </span><span class="s0">opt_arr = []; 
                 $dropList.each(</span><span class="s1">function </span><span class="s0">(){ 
                   </span><span class="s1">if </span><span class="s0">($(</span><span class="s1">this</span><span class="s0">).is(</span><span class="s3">':checked'</span><span class="s0">))  opt_arr.push($(</span><span class="s1">this</span><span class="s0">).val()); 
                    
                 }); 
                 </span><span class="s1">var </span><span class="s0">$dropList_selected = $content.children().children(</span><span class="s3">'input:checked'</span><span class="s0">); 
                 $ipt.val(opt_arr.join(</span><span class="s3">';'</span><span class="s0">)); 
                 </span><span class="s1">var </span><span class="s0">o = $all[</span><span class="s4">0</span><span class="s0">]; 
                 </span><span class="s1">var </span><span class="s0">n1 = $dropList_selected.length; 
                 </span><span class="s1">var </span><span class="s0">n2 = $dropList.length; 
                 o.checked = (n1 === n2) ? </span><span class="s3">'checked' </span><span class="s0">: </span><span class="s3">''</span><span class="s0">; 
            }); 
         }); 
     }, 
   }); 
})(jQuery);</span></pre>
</body>
</html>