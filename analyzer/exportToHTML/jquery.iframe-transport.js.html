<html>
<head>
<title>jquery.iframe-transport.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,128); font-style: italic; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(0,0,128); font-weight: bold; }
.s3 { color: rgb(0,128,0); font-weight: bold; }
.s4 { color: rgb(0,0,255); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
jquery.iframe-transport.js</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">/* 
 * jQuery Iframe Transport Plugin 1.8.3 
 * https://github.com/blueimp/jQuery-File-Upload 
 * 
 * Copyright 2011, Sebastian Tschan 
 * https://blueimp.net 
 * 
 * Licensed under the MIT license: 
 * http://www.opensource.org/licenses/MIT 
 */</span><span class="s1"> 
 
</span><span class="s0">/* global define, require, window, document */</span><span class="s1"> 
 
(</span><span class="s2">function </span><span class="s1">(factory) { 
    </span><span class="s3">'use strict'</span><span class="s1">; 
    </span><span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">define === </span><span class="s3">'function' </span><span class="s1">&amp;&amp; define.amd) { 
        </span><span class="s0">// Register as an anonymous AMD module:</span><span class="s1"> 
        define([</span><span class="s3">'jquery'</span><span class="s1">], factory); 
    } </span><span class="s2">else if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">exports === </span><span class="s3">'object'</span><span class="s1">) { 
        </span><span class="s0">// Node/CommonJS:</span><span class="s1"> 
        factory(require(</span><span class="s3">'jquery'</span><span class="s1">)); 
    } </span><span class="s2">else </span><span class="s1">{ 
        </span><span class="s0">// Browser globals:</span><span class="s1"> 
        factory(window.jQuery); 
    } 
}(</span><span class="s2">function </span><span class="s1">($) { 
    </span><span class="s3">'use strict'</span><span class="s1">; 
 
    </span><span class="s0">// Helper variable to create unique names for the transport iframes:</span><span class="s1"> 
    </span><span class="s2">var </span><span class="s1">counter = </span><span class="s4">0</span><span class="s1">; 
 
    </span><span class="s0">// The iframe transport accepts four additional options:</span><span class="s1"> 
    </span><span class="s0">// options.fileInput: a jQuery collection of file input fields</span><span class="s1"> 
    </span><span class="s0">// options.paramName: the parameter name for the file form data,</span><span class="s1"> 
    </span><span class="s0">//  overrides the name property of the file input field(s),</span><span class="s1"> 
    </span><span class="s0">//  can be a string or an array of strings.</span><span class="s1"> 
    </span><span class="s0">// options.formData: an array of objects with name and value properties,</span><span class="s1"> 
    </span><span class="s0">//  equivalent to the return data of .serializeArray(), e.g.:</span><span class="s1"> 
    </span><span class="s0">//  [{name: 'a', value: 1}, {name: 'b', value: 2}]</span><span class="s1"> 
    </span><span class="s0">// options.initialIframeSrc: the URL of the initial iframe src,</span><span class="s1"> 
    </span><span class="s0">//  by default set to &quot;javascript:false;&quot;</span><span class="s1"> 
    $.ajaxTransport(</span><span class="s3">'iframe'</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(options) { 
        </span><span class="s2">if </span><span class="s1">(options.async) { 
            </span><span class="s0">// javascript:false as initial iframe src</span><span class="s1"> 
            </span><span class="s0">// prevents warning popups on HTTPS in IE6:</span><span class="s1"> 
            </span><span class="s0">/*jshint scripturl: true */</span><span class="s1"> 
            </span><span class="s2">var </span><span class="s1">initialIframeSrc = options.initialIframeSrc || </span><span class="s3">'javascript:false;'</span><span class="s1">, 
            </span><span class="s0">/*jshint scripturl: false */</span><span class="s1"> 
                form, 
                iframe, 
                addParamChar; 
            </span><span class="s2">return </span><span class="s1">{ 
                send: </span><span class="s2">function </span><span class="s1">(_, completeCallback) { 
                    form = $(</span><span class="s3">'&lt;form style=&quot;display:none;&quot;&gt;&lt;/form&gt;'</span><span class="s1">); 
                    form.attr(</span><span class="s3">'accept-charset'</span><span class="s1">, options.formAcceptCharset); 
                    addParamChar = </span><span class="s4">/\?/</span><span class="s1">.test(options.url) ? </span><span class="s3">'&amp;' </span><span class="s1">: </span><span class="s3">'?'</span><span class="s1">; 
                    </span><span class="s0">// XDomainRequest only supports GET and POST:</span><span class="s1"> 
                    </span><span class="s2">if </span><span class="s1">(options.type === </span><span class="s3">'DELETE'</span><span class="s1">) { 
                        options.url = options.url + addParamChar + </span><span class="s3">'_method=DELETE'</span><span class="s1">; 
                        options.type = </span><span class="s3">'POST'</span><span class="s1">; 
                    } </span><span class="s2">else if </span><span class="s1">(options.type === </span><span class="s3">'PUT'</span><span class="s1">) { 
                        options.url = options.url + addParamChar + </span><span class="s3">'_method=PUT'</span><span class="s1">; 
                        options.type = </span><span class="s3">'POST'</span><span class="s1">; 
                    } </span><span class="s2">else if </span><span class="s1">(options.type === </span><span class="s3">'PATCH'</span><span class="s1">) { 
                        options.url = options.url + addParamChar + </span><span class="s3">'_method=PATCH'</span><span class="s1">; 
                        options.type = </span><span class="s3">'POST'</span><span class="s1">; 
                    } 
                    </span><span class="s0">// IE versions below IE8 cannot set the name property of</span><span class="s1"> 
                    </span><span class="s0">// elements that have already been added to the DOM,</span><span class="s1"> 
                    </span><span class="s0">// so we set the name along with the iframe HTML markup:</span><span class="s1"> 
                    counter += </span><span class="s4">1</span><span class="s1">; 
                    iframe = $( 
                        </span><span class="s3">'&lt;iframe src=&quot;' </span><span class="s1">+ initialIframeSrc + 
                            </span><span class="s3">'&quot; name=&quot;iframe-transport-' </span><span class="s1">+ counter + </span><span class="s3">'&quot;&gt;&lt;/iframe&gt;'</span><span class="s1"> 
                    ).bind(</span><span class="s3">'load'</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() { 
                        </span><span class="s2">var </span><span class="s1">fileInputClones, 
                            paramNames = $.isArray(options.paramName) ? 
                                    options.paramName : [options.paramName]; 
                        iframe 
                            .unbind(</span><span class="s3">'load'</span><span class="s1">) 
                            .bind(</span><span class="s3">'load'</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() { 
                                </span><span class="s2">var </span><span class="s1">response; 
                                </span><span class="s0">// Wrap in a try/catch block to catch exceptions thrown</span><span class="s1"> 
                                </span><span class="s0">// when trying to access cross-domain iframe contents:</span><span class="s1"> 
                                </span><span class="s2">try </span><span class="s1">{ 
                                    response = iframe.contents(); 
                                    </span><span class="s0">// Google Chrome and Firefox do not throw an</span><span class="s1"> 
                                    </span><span class="s0">// exception when calling iframe.contents() on</span><span class="s1"> 
                                    </span><span class="s0">// cross-domain requests, so we unify the response:</span><span class="s1"> 
                                    </span><span class="s2">if </span><span class="s1">(!response.length || !response[</span><span class="s4">0</span><span class="s1">].firstChild) { 
                                        </span><span class="s2">throw new </span><span class="s1">Error(); 
                                    } 
                                } </span><span class="s2">catch </span><span class="s1">(e) { 
                                    response = undefined; 
                                } 
                                </span><span class="s0">// The complete callback returns the</span><span class="s1"> 
                                </span><span class="s0">// iframe content document as response object:</span><span class="s1"> 
                                completeCallback( 
                                    </span><span class="s4">200</span><span class="s1">, 
                                    </span><span class="s3">'success'</span><span class="s1">, 
                                    {</span><span class="s3">'iframe'</span><span class="s1">: response} 
                                ); 
                                </span><span class="s0">// Fix for IE endless progress bar activity bug</span><span class="s1"> 
                                </span><span class="s0">// (happens on form submits to iframe targets):</span><span class="s1"> 
                                $(</span><span class="s3">'&lt;iframe src=&quot;' </span><span class="s1">+ initialIframeSrc + </span><span class="s3">'&quot;&gt;&lt;/iframe&gt;'</span><span class="s1">) 
                                    .appendTo(form); 
                                window.setTimeout(</span><span class="s2">function </span><span class="s1">() { 
                                    </span><span class="s0">// Removing the form in a setTimeout call</span><span class="s1"> 
                                    </span><span class="s0">// allows Chrome's developer tools to display</span><span class="s1"> 
                                    </span><span class="s0">// the response result</span><span class="s1"> 
                                    form.remove(); 
                                }, </span><span class="s4">0</span><span class="s1">); 
                            }); 
                        form 
                            .prop(</span><span class="s3">'target'</span><span class="s1">, iframe.prop(</span><span class="s3">'name'</span><span class="s1">)) 
                            .prop(</span><span class="s3">'action'</span><span class="s1">, options.url) 
                            .prop(</span><span class="s3">'method'</span><span class="s1">, options.type); 
                        </span><span class="s2">if </span><span class="s1">(options.formData) { 
                            $.each(options.formData, </span><span class="s2">function </span><span class="s1">(index, field) { 
                                $(</span><span class="s3">'&lt;input type=&quot;hidden&quot;/&gt;'</span><span class="s1">) 
                                    .prop(</span><span class="s3">'name'</span><span class="s1">, field.name) 
                                    .val(field.value) 
                                    .appendTo(form); 
                            }); 
                        } 
                        </span><span class="s2">if </span><span class="s1">(options.fileInput &amp;&amp; options.fileInput.length &amp;&amp; 
                                options.type === </span><span class="s3">'POST'</span><span class="s1">) { 
                            fileInputClones = options.fileInput.clone(); 
                            </span><span class="s0">// Insert a clone for each file input field:</span><span class="s1"> 
                            options.fileInput.after(</span><span class="s2">function </span><span class="s1">(index) { 
                                </span><span class="s2">return </span><span class="s1">fileInputClones[index]; 
                            }); 
                            </span><span class="s2">if </span><span class="s1">(options.paramName) { 
                                options.fileInput.each(</span><span class="s2">function </span><span class="s1">(index) { 
                                    $(</span><span class="s2">this</span><span class="s1">).prop( 
                                        </span><span class="s3">'name'</span><span class="s1">, 
                                        paramNames[index] || options.paramName 
                                    ); 
                                }); 
                            } 
                            </span><span class="s0">// Appending the file input fields to the hidden form</span><span class="s1"> 
                            </span><span class="s0">// removes them from their original location:</span><span class="s1"> 
                            form 
                                .append(options.fileInput) 
                                .prop(</span><span class="s3">'enctype'</span><span class="s1">, </span><span class="s3">'multipart/form-data'</span><span class="s1">) 
                                </span><span class="s0">// enctype must be set as encoding for IE:</span><span class="s1"> 
                                .prop(</span><span class="s3">'encoding'</span><span class="s1">, </span><span class="s3">'multipart/form-data'</span><span class="s1">); 
                            </span><span class="s0">// Remove the HTML5 form attribute from the input(s):</span><span class="s1"> 
                            options.fileInput.removeAttr(</span><span class="s3">'form'</span><span class="s1">); 
                        } 
                        form.submit(); 
                        </span><span class="s0">// Insert the file input fields at their original location</span><span class="s1"> 
                        </span><span class="s0">// by replacing the clones with the originals:</span><span class="s1"> 
                        </span><span class="s2">if </span><span class="s1">(fileInputClones &amp;&amp; fileInputClones.length) { 
                            options.fileInput.each(</span><span class="s2">function </span><span class="s1">(index, input) { 
                                </span><span class="s2">var </span><span class="s1">clone = $(fileInputClones[index]); 
                                </span><span class="s0">// Restore the original name and form properties:</span><span class="s1"> 
                                $(input) 
                                    .prop(</span><span class="s3">'name'</span><span class="s1">, clone.prop(</span><span class="s3">'name'</span><span class="s1">)) 
                                    .attr(</span><span class="s3">'form'</span><span class="s1">, clone.attr(</span><span class="s3">'form'</span><span class="s1">)); 
                                clone.replaceWith(input); 
                            }); 
                        } 
                    }); 
                    form.append(iframe).appendTo(document.body); 
                }, 
                abort: </span><span class="s2">function </span><span class="s1">() { 
                    </span><span class="s2">if </span><span class="s1">(iframe) { 
                        </span><span class="s0">// javascript:false as iframe src aborts the request</span><span class="s1"> 
                        </span><span class="s0">// and prevents warning popups on HTTPS in IE6.</span><span class="s1"> 
                        </span><span class="s0">// concat is used to avoid the &quot;Script URL&quot; JSLint error:</span><span class="s1"> 
                        iframe 
                            .unbind(</span><span class="s3">'load'</span><span class="s1">) 
                            .prop(</span><span class="s3">'src'</span><span class="s1">, initialIframeSrc); 
                    } 
                    </span><span class="s2">if </span><span class="s1">(form) { 
                        form.remove(); 
                    } 
                } 
            }; 
        } 
    }); 
 
    </span><span class="s0">// The iframe transport returns the iframe content document as response.</span><span class="s1"> 
    </span><span class="s0">// The following adds converters from iframe to text, json, html, xml</span><span class="s1"> 
    </span><span class="s0">// and script.</span><span class="s1"> 
    </span><span class="s0">// Please note that the Content-Type for JSON responses has to be text/plain</span><span class="s1"> 
    </span><span class="s0">// or text/html, if the browser doesn't include application/json in the</span><span class="s1"> 
    </span><span class="s0">// Accept header, else IE will show a download dialog.</span><span class="s1"> 
    </span><span class="s0">// The Content-Type for XML responses on the other hand has to be always</span><span class="s1"> 
    </span><span class="s0">// application/xml or text/xml, so IE properly parses the XML response.</span><span class="s1"> 
    </span><span class="s0">// See also</span><span class="s1"> 
    </span><span class="s0">// https://github.com/blueimp/jQuery-File-Upload/wiki/Setup#content-type-negotiation</span><span class="s1"> 
    $.ajaxSetup({ 
        converters: { 
            </span><span class="s3">'iframe text'</span><span class="s1">: </span><span class="s2">function </span><span class="s1">(iframe) { 
                </span><span class="s2">return </span><span class="s1">iframe &amp;&amp; $(iframe[</span><span class="s4">0</span><span class="s1">].body).text(); 
            }, 
            </span><span class="s3">'iframe json'</span><span class="s1">: </span><span class="s2">function </span><span class="s1">(iframe) { 
                </span><span class="s2">return </span><span class="s1">iframe &amp;&amp; $.parseJSON($(iframe[</span><span class="s4">0</span><span class="s1">].body).text()); 
            }, 
            </span><span class="s3">'iframe html'</span><span class="s1">: </span><span class="s2">function </span><span class="s1">(iframe) { 
                </span><span class="s2">return </span><span class="s1">iframe &amp;&amp; $(iframe[</span><span class="s4">0</span><span class="s1">].body).html(); 
            }, 
            </span><span class="s3">'iframe xml'</span><span class="s1">: </span><span class="s2">function </span><span class="s1">(iframe) { 
                </span><span class="s2">var </span><span class="s1">xmlDoc = iframe &amp;&amp; iframe[</span><span class="s4">0</span><span class="s1">]; 
                </span><span class="s2">return </span><span class="s1">xmlDoc &amp;&amp; $.isXMLDoc(xmlDoc) ? xmlDoc : 
                        $.parseXML((xmlDoc.XMLDocument &amp;&amp; xmlDoc.XMLDocument.xml) || 
                            $(xmlDoc.body).html()); 
            }, 
            </span><span class="s3">'iframe script'</span><span class="s1">: </span><span class="s2">function </span><span class="s1">(iframe) { 
                </span><span class="s2">return </span><span class="s1">iframe &amp;&amp; $.globalEval($(iframe[</span><span class="s4">0</span><span class="s1">].body).text()); 
            } 
        } 
    }); 
 
})); 
</span></pre>
</body>
</html>